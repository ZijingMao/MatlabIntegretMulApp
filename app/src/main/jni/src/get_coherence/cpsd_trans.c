/*
 * Academic License - for use in teaching, academic research, and meeting
 * course requirements at degree granting institutions only.  Not for
 * government, commercial, or other organizational use.
 * File: cpsd_trans.c
 *
 * MATLAB Coder version            : 3.0
 * C/C++ source code generated on  : 18-May-2016 16:04:51
 */

/* Include Files */
#include "rt_nonfinite.h"
#include "get_coherence.h"
#include "cpsd_trans.h"
#include "compute_cross_fft.h"
#include "power.h"
#include "abs1.h"
#include "compute_psd.h"
#include "rdivide.h"
#include "linspace.h"

/* Function Definitions */

/*
 * Arguments    : const double x[768]
 *                const double y[768]
 *                double fs
 *                double Cxy[513]
 *                double f[513]
 * Return Type  : void
 */
void cpsd_trans(const double x[768], const double y[768], double fs, double Cxy
                [513], double f[513])
{
  double b_y;
  creal_T Sxx[1024];
  int i;
  int i2;
  int i3;
  int i4;
  int i5;
  double x_data[765];
  int loop_ub;
  double y_data[765];
  creal_T Sxxk[1024];
  static const double dv3[170] = { 0.080000000000000016, 0.080317880683141107,
    0.0812710833928742, 0.082858290717336081, 0.0850773089932721,
    0.08792507133787586, 0.091397641887497327, 0.09549022123736,
    0.10019715307477034, 0.10551193199665004, 0.11142721250058868,
    0.11793481913698806, 0.12502575780826913, 0.13269022819952347,
    0.14091763732342982, 0.14969661416071517, 0.159015025375926,
    0.16885999208678887, 0.1792179076639841, 0.19007445653673077,
    0.20141463397819304, 0.21322276684336222, 0.22548253523075218,
    0.23817699503797102, 0.25128860137999431, 0.26479923283777373,
    0.27869021650366838, 0.2929423537890814, 0.30753594695863695,
    0.32245082635422068, 0.33766637827126228, 0.35316157344872806,
    0.3689149961334508, 0.38490487367862691, 0.40110910663557209,
    0.41750529929714675, 0.43407079065063692, 0.45078268569731217,
    0.46761788709537244, 0.48455312708255144, 0.5015649996342566,
    0.51862999281280009, 0.53572452126301051, 0.55282495880931515,
    0.569907671109239, 0.586949048318192, 0.60392553772039581,
    0.6208136762808576, 0.637590123073392, 0.65423169153988114,
    0.67071538153618326, 0.6870184111203993, 0.70311824803956646,
    0.718992640871257, 0.73461964977704608, 0.74997767682534011,
    0.76504549584166237, 0.77980228174513222, 0.79422763933060248,
    0.80830163145666512, 0.82200480660057429, 0.83531822574199976,
    0.84822348853845631, 0.86070275875623148, 0.87273878892166445,
    0.8843149441587066, 0.89541522517981442, 0.90602429039840549,
    0.91612747713230924, 0.92571082186891329, 0.93476107956399312,
    0.94326574194755408, 0.95121305481138618, 0.95859203425443562,
    0.96539248186354532, 0.97160499880857731, 0.97722099883244251,
    0.98223272011807938, 0.986633236015984, 0.99041646461746136,
    0.993577177160371, 0.996111005255746, 0.99801444692530017,
    0.99928487144147549, 0.99992052296334588, 0.99992052296334588,
    0.99928487144147549, 0.99801444692530017, 0.996111005255746,
    0.993577177160371, 0.99041646461746136, 0.986633236015984,
    0.98223272011807938, 0.97722099883244251, 0.97160499880857731,
    0.96539248186354532, 0.95859203425443562, 0.95121305481138618,
    0.94326574194755408, 0.93476107956399312, 0.92571082186891329,
    0.91612747713230924, 0.90602429039840549, 0.89541522517981442,
    0.8843149441587066, 0.87273878892166445, 0.86070275875623148,
    0.84822348853845631, 0.83531822574199976, 0.82200480660057429,
    0.80830163145666512, 0.79422763933060248, 0.77980228174513222,
    0.76504549584166237, 0.74997767682534011, 0.73461964977704608,
    0.718992640871257, 0.70311824803956646, 0.6870184111203993,
    0.67071538153618326, 0.65423169153988114, 0.637590123073392,
    0.6208136762808576, 0.60392553772039581, 0.586949048318192,
    0.569907671109239, 0.55282495880931515, 0.53572452126301051,
    0.51862999281280009, 0.5015649996342566, 0.48455312708255144,
    0.46761788709537244, 0.45078268569731217, 0.43407079065063692,
    0.41750529929714675, 0.40110910663557209, 0.38490487367862691,
    0.3689149961334508, 0.35316157344872806, 0.33766637827126228,
    0.32245082635422068, 0.30753594695863695, 0.2929423537890814,
    0.27869021650366838, 0.26479923283777373, 0.25128860137999431,
    0.23817699503797102, 0.22548253523075218, 0.21322276684336222,
    0.20141463397819304, 0.19007445653673077, 0.1792179076639841,
    0.16885999208678887, 0.159015025375926, 0.14969661416071517,
    0.14091763732342982, 0.13269022819952347, 0.12502575780826913,
    0.11793481913698806, 0.11142721250058868, 0.10551193199665004,
    0.10019715307477034, 0.09549022123736, 0.091397641887497327,
    0.08792507133787586, 0.0850773089932721, 0.082858290717336081,
    0.0812710833928742, 0.080317880683141107, 0.080000000000000016 };

  creal_T b_Sxx[1024];
  creal_T dcv1[1024];
  creal_T dcv2[513];
  double dv4[513];

  /*  the length of the window */
  /*  Compute the number of segments */
  b_y = fs / 2.0;
  memset(&Sxx[0], 0, sizeof(creal_T) << 10);
  for (i = 0; i < 8; i++) {
    if (1 + 85 * i > 170 + 85 * i) {
      i2 = 1;
      i3 = 0;
    } else {
      i2 = 85 * i + 1;
      i3 = 85 * i + 170;
    }

    if (1 + 85 * i > 170 + 85 * i) {
      i4 = 1;
      i5 = 0;
    } else {
      i4 = 85 * i + 1;
      i5 = 85 * i + 170;
    }

    loop_ub = (i3 - i2) + 1;
    for (i3 = 0; i3 < loop_ub; i3++) {
      x_data[i3] = x[(i2 + i3) - 1];
    }

    loop_ub = (i5 - i4) + 1;
    for (i2 = 0; i2 < loop_ub; i2++) {
      y_data[i2] = y[(i4 + i2) - 1];
    }

    compute_cross_fft(x_data, y_data, dv3, Sxxk);
    for (i2 = 0; i2 < 1024; i2++) {
      Sxx[i2].re += Sxxk[i2].re;
      Sxx[i2].im += Sxxk[i2].im;
    }
  }

  memcpy(&b_Sxx[0], &Sxx[0], sizeof(creal_T) << 10);

  /*  Average the sum of the periodograms */
  linspace(f);
  for (i2 = 0; i2 < 513; i2++) {
    f[i2] *= b_y;
  }

  rdivide(b_Sxx, 8.0, dcv1);
  compute_psd(dcv1, fs, dcv2);
  b_abs(dcv2, dv4);
  power(dv4, Cxy);
}

/*
 * File trailer for cpsd_trans.c
 *
 * [EOF]
 */

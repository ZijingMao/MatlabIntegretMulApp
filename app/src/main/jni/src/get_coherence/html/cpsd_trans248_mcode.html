<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="65,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1U3">Cxy</span>, <span class="var type1" id="S3T2U4">f</span> ] = cpsd_trans( <span class="var type1" id="S4T3U7">x</span>,<span class="var type1" id="S5T3U8">y</span>,<span class="var type2" id="S6T4V2U9">NFFT</span>,<span class="var type1" id="S7T4U10">fs</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="65,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,3" id="srcline3"> 3</a></span><span class="line"><span class="keyword">if</span> length(<span class="var type1" id="S4T3U16">x</span>) ~= length(<span class="var type1" id="S5T3U19">y</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="65,4" id="srcline4"> 4</a></span><span class="line">    error(message(<span class="string">'signal:welchparse:MismatchedLength'</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="65,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T4:U9"><span class="var type1" id="S11T4U28">M</span> = <span class="mxinfo " id="T4:U11">length(<span class="var type1" id="S4T3U31">x</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T4:U13"><span class="var type1" id="S12T4U34">L</span> = <span class="mxinfo " id="T4:U15">fix(<span class="var type1" id="S11T4U38">M</span>/4.5)</span></span>;  <span class="comment">% the length of the window</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T4:U17"><span class="var type1" id="S14T4U42">noverlap</span> = <span class="mxinfo " id="T4:U19">fix(<span class="var type1" id="S12T4U46">L</span>/2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,10" id="srcline10">10</a></span><span class="line"><span class="comment">% Compute the number of segments</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T4:U21"><span class="var type1" id="S15T4U50">k</span> = <span class="mxinfo " id="T4:U23">(<span class="var type1" id="S11T4U54">M</span>-<span class="var type1" id="S14T4U55">noverlap</span>)./(<span class="var type1" id="S12T4U58">L</span>-<span class="var type1" id="S14T4U59">noverlap</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T30:U28"><span class="var type1" id="S16T30U62">win</span> = <span class="mxinfo " id="T30:U30"><span class="fcn" id="F93N7:B64">def_hamming</span>(<span class="var type1" id="S12T4U65">L</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T2:U32"><span class="var type1" id="S18T2U68">freq_space</span> = <span class="mxinfo " id="T2:U34">linspace(<span class="mxinfo " id="T4:U35">0</span>,<span class="mxinfo " id="T4:U36">1</span>,<span class="var type1" id="S6T4U75">NFFT</span>/2+1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T2:U38"><span class="var type1" id="S20T2U80">w</span> = <span class="mxinfo " id="T2:U40"><span class="mxinfo " id="T4:U41"><span class="var type1" id="S7T4U83">fs</span> / <span class="mxinfo " id="T4:U43">2</span></span> .* <span class="var type1" id="S18T2U85">freq_space</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T4:U45"><span class="var type1" id="S21T4U88">LminusOverlap</span> = <span class="mxinfo " id="T4:U47"><span class="var type1" id="S12T4U90">L</span>-<span class="var type1" id="S14T4U91">noverlap</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T31:U50"><span class="var type1" id="S22T31U94">xStart</span> = <span class="mxinfo " id="T31:U52">1:<span class="var type1" id="S21T4U98">LminusOverlap</span>:<span class="var type1" id="S15T4U100">k</span>*<span class="var type1" id="S21T4U101">LminusOverlap</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T31:U56"><span class="var type1" id="S23T31U104">xEnd</span>   = <span class="mxinfo " id="T31:U58"><span class="var type1" id="S22T31U107">xStart</span>+<span class="var type1" id="S12T4U108">L</span>-1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T4:U61"><span class="var type1" id="S15T4U112">k</span> = <span class="mxinfo " id="T4:U63">fix(<span class="var type1" id="S15T4U115">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo " id="T44:U65"><span class="var type1" id="S24T44U118">Sxx</span> = <span class="mxinfo " id="T44:U67">zeros(<span class="var type1" id="S6T4U121">NFFT</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T37:U69"><span class="var type1" id="S24T37U125">Sxx</span> = <span class="mxinfo " id="T37:U71">complex(<span class="var type1" id="S24T44U128">Sxx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,27" id="srcline27">27</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S27T4U131">i</span> = <span class="mxinfo " id="T4:U74">1</span>:<span class="var type1" id="S15T4U134">k</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo " id="T37:U76">[<span class="var type1" id="S28T37U138">Sxxk</span>] = <span class="mxinfo " id="T37:U78"><span class="fcn" id="F221N3:B140">compute_cross_fft</span>(<span class="mxinfo " id="T40:U79"><span class="var type1" id="S4T3U142">x</span>(<span class="mxinfo " id="T45:U81"><span class="mxinfo " id="T4:U82"><span class="var type1" id="S22T31U145">xStart</span>(<span class="var type1" id="S27T4U146">i</span>)</span>:<span class="mxinfo " id="T4:U85"><span class="var type1" id="S23T31U148">xEnd</span>(<span class="var type1" id="S27T4U149">i</span>)</span></span>)</span>, <span class="mxinfo " id="T40:U88"><span class="var type1" id="S5T3U151">y</span>(<span class="mxinfo " id="T45:U90"><span class="mxinfo " id="T4:U91"><span class="var type1" id="S22T31U154">xStart</span>(<span class="var type1" id="S27T4U155">i</span>)</span>:<span class="mxinfo " id="T4:U94"><span class="var type1" id="S23T31U157">xEnd</span>(<span class="var type1" id="S27T4U158">i</span>)</span></span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,29" id="srcline29">29</a></span><span class="line">        <span class="var type1" id="S16T30U159">win</span>, <span class="var type1" id="S6T4U160">NFFT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo " id="T37:U99"><span class="var type1" id="S24T37U163">Sxx</span>  = <span class="mxinfo " id="T37:U101"><span class="var type1" id="S24T37U165">Sxx</span> + <span class="var type1" id="S28T37U166">Sxxk</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,31" id="srcline31">31</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T37:U104"><span class="var type1" id="S24T37U169">Sxx</span> = <span class="mxinfo " id="T37:U106"><span class="var type1" id="S24T37U171">Sxx</span>./<span class="var type1" id="S15T4U172">k</span></span></span>; <span class="comment">% Average the sum of the periodograms</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,34" id="srcline34">34</a></span><span class="line">[<span class="var type1" id="S30T5U176">cxy</span>, <span class="var type1" id="S3T2U177">f</span>] = <span class="fcn" id="F217N5:B179">compute_psd</span>(<span class="var type1" id="S24T37U180">Sxx</span>,<span class="var type1" id="S20T2U181">w</span>,<span class="var type1" id="S6T4U182">NFFT</span>,<span class="var type1" id="S7T4U183">fs</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="65,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo " id="T1:U115"><span class="var type1" id="S2T1U186">Cxy</span> = <span class="mxinfo " id="T1:U117"><span class="mxinfo " id="T1:U118">abs(<span class="var type1" id="S30T5U190">cxy</span>)</span>.^2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="65,37" id="srcline37">37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="65,38" id="srcline38">38</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="65,39" id="srcline39">39</a></span><span class="line"></span></span>
</pre>

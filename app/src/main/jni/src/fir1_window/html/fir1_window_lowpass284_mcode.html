<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="75,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1U3">output_data</span> ] = fir1_window_lowpass( <span class="var type1" id="S3T1U6">input_data</span>, <span class="var type1" id="S4T2U7">hicutoff</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="75,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="75,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%% do low pass</span></span></span>
<span class="srcline"><span class="lineno"><a href="75,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T2:U4"><span class="var type1" id="S5T2U10">TRANSWIDTHRATIO</span> = <span class="mxinfo " id="T2:U6">0.25</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T2:U7"><span class="var type1" id="S6T2U14">fNyquist</span> = <span class="mxinfo " id="T2:U9">128</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% filtorder = 1690;</span></span></span>
<span class="srcline"><span class="lineno"><a href="75,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T2:U10"><span class="var type1" id="S7T2U18">revfilt</span> = <span class="mxinfo " id="T2:U12">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T2:U13"><span class="var type1" id="S8T2U22">edgeArray</span> = <span class="var type1" id="S4T2U23">hicutoff</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T2:U16"><span class="var type1" id="S9T2U26">maxTBWArray</span> = <span class="var type1" id="S8T2U27">edgeArray</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T2:U19"><span class="var type1" id="S9T2U31">maxTBWArray</span>(end) = <span class="mxinfo " id="T2:U21"><span class="var type1" id="S6T2U35">fNyquist</span> - <span class="var type1" id="S8T2U37">edgeArray</span>(end)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T2:U24"><span class="var type1" id="S11T2U42">maxDf</span> = <span class="mxinfo " id="T2:U26">min(<span class="var type1" id="S9T2U45">maxTBWArray</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T2:U28"><span class="var type1" id="S13T2U48">df</span> = <span class="mxinfo " id="T2:U30">min(<span class="mxinfo " id="T8:U31">[<span class="mxinfo " id="T2:U32">max(<span class="mxinfo " id="T8:U33">[<span class="mxinfo " id="T2:U34"><span class="var type1" id="S8T2U59">edgeArray</span>(1) * <span class="var type1" id="S5T2U61">TRANSWIDTHRATIO</span></span> <span class="mxinfo " id="T2:U37">2</span>]</span>)</span> <span class="var type1" id="S11T2U63">maxDf</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T2:U39"><span class="var type1" id="S15T2U66">filtorder</span> = <span class="mxinfo " id="T2:U41"><span class="mxinfo " id="T2:U42">3.3</span> / (<span class="mxinfo " id="T2:U43"><span class="var type1" id="S13T2U71">df</span> / (<span class="mxinfo " id="T2:U45"><span class="var type1" id="S6T2U74">fNyquist</span>*2</span>)</span>)</span></span>; <span class="comment">% Hamming window</span></span></span>
<span class="srcline"><span class="lineno"><a href="75,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T2:U47"><span class="var type1" id="S15T2U78">filtorder</span> = <span class="mxinfo " id="T2:U49"><span class="mxinfo " id="T2:U50">ceil(<span class="mxinfo " id="T2:U51"><span class="var type1" id="S15T2U83">filtorder</span> / <span class="mxinfo " id="T2:U53">2</span></span>)</span> * <span class="mxinfo " id="T2:U54">2</span></span></span>; <span class="comment">% Filter order must be even.</span></span></span>
<span class="srcline"><span class="lineno"><a href="75,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T45:U55"><span class="var type1" id="S17T45U88">dfArray</span> = {<span class="var type1" id="S13T2U91">df</span>, <span class="mxinfo " id="T8:U58">[<span class="mxinfo " id="T2:U59">-<span class="var type1" id="S13T2U95">df</span></span>, <span class="var type1" id="S13T2U96">df</span>]</span>; <span class="mxinfo " id="T2:U62">-<span class="var type1" id="S13T2U99">df</span></span>, <span class="mxinfo " id="T8:U64">[<span class="var type1" id="S13T2U102">df</span>, <span class="mxinfo " id="T2:U66">-<span class="var type1" id="S13T2U104">df</span></span>]</span>}</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T2:U68"><span class="var type1" id="S18T2U107">cutoffArray</span> = <span class="mxinfo " id="T2:U70"><span class="var type1" id="S8T2U109">edgeArray</span> + <span class="mxinfo " id="T2:U72"><span class="var type1" id="S17T45U112">dfArray</span>{<span class="var type1" id="S7T2U114">revfilt</span> + 1, length(<span class="var type1" id="S8T2U118">edgeArray</span>)} / <span class="mxinfo " id="T2:U76">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T25:U77"><span class="var type1" id="S20T25U122">winArray</span> = <span class="mxinfo " id="T25:U79"><span class="fcn" id="F110N9:B124">hamming</span>(<span class="mxinfo " id="T2:U80"><span class="var type1" id="S15T2U126">filtorder</span> + <span class="mxinfo " id="T2:U82">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="75,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T2:U83"><span class="var type1" id="S22T2U130">f</span> = <span class="mxinfo " id="T2:U85"><span class="var type1" id="S18T2U132">cutoffArray</span> / <span class="var type1" id="S6T2U133">fNyquist</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T25:U88"><span class="var type1" id="S23T25U136">w</span> = <span class="var type1" id="S20T25U137">winArray</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T2:U91"><span class="var type1" id="S24T2U140">m</span> = <span class="var type1" id="S15T2U141">filtorder</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo " id="T2:U94"><span class="var type1" id="S22T2U144">f</span> = <span class="mxinfo " id="T2:U96"><span class="var type1" id="S22T2U146">f</span> / <span class="mxinfo " id="T2:U98">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T23:U99"><span class="var type1" id="S23T23U150">w</span> = <span class="mxinfo " id="T23:U101"><span class="mxinfo " id="T25:U102"><span class="var type1" id="S23T25U153">w</span>(:)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo " id="T23:U104"><span class="var type1" id="S25T23U157">b</span> = <span class="mxinfo " id="T23:U106"><span class="fcn" id="F163N7:B159">fkernel</span>(<span class="var type1" id="S24T2U160">m</span>, <span class="var type1" id="S22T2U162">f</span>(1), <span class="var type1" id="S23T23U164">w</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="75,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T2:U110"><span class="var type1" id="S27T2U167">nFrames</span> = <span class="mxinfo " id="T2:U112">1000</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T1:U113"><span class="var type1" id="S2T1U171">output_data</span> = <span class="mxinfo " id="T1:U115"><span class="fcn" id="F282N6:B173">firfilter</span>(<span class="var type1" id="S3T1U174">input_data</span>, <span class="var type1" id="S25T23U175">b</span>, <span class="var type1" id="S27T2U176">nFrames</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="75,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="75,29" id="srcline29">29</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="75,30" id="srcline30">30</a></span><span class="line"></span></span>
</pre>

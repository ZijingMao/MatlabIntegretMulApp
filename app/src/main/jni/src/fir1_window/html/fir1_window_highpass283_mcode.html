<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="74,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1U3">output_data</span> ] = fir1_window_highpass( <span class="var type1" id="S3T1U6">input_data</span>, <span class="var type1" id="S4T2U7">locutoff</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="74,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%% do high pass first</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T2:U4"><span class="var type1" id="S5T2U10">TRANSWIDTHRATIO</span> = <span class="mxinfo " id="T2:U6">0.25</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T2:U7"><span class="var type1" id="S6T2U14">fNyquist</span> = <span class="mxinfo " id="T2:U9">128</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% filtorder = 1690;</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T2:U10"><span class="var type1" id="S7T2U18">revfilt</span> = <span class="mxinfo " id="T2:U12">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T2:U13"><span class="var type1" id="S8T2U22">edgeArray</span> = <span class="var type1" id="S4T2U23">locutoff</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T2:U16"><span class="var type1" id="S9T2U26">maxTBWArray</span> = <span class="var type1" id="S8T2U27">edgeArray</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T2:U19"><span class="var type1" id="S10T2U30">maxDf</span> = <span class="mxinfo " id="T2:U21">min(<span class="var type1" id="S9T2U33">maxTBWArray</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T2:U23"><span class="var type1" id="S12T2U36">df</span> = <span class="mxinfo " id="T2:U25">min(<span class="mxinfo " id="T8:U26">[<span class="mxinfo " id="T2:U27">max(<span class="mxinfo " id="T8:U28">[<span class="mxinfo " id="T2:U29"><span class="var type1" id="S8T2U47">edgeArray</span>(1) * <span class="var type1" id="S5T2U49">TRANSWIDTHRATIO</span></span> <span class="mxinfo " id="T2:U32">2</span>]</span>)</span> <span class="var type1" id="S10T2U51">maxDf</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T2:U34"><span class="var type1" id="S14T2U54">filtorder</span> = <span class="mxinfo " id="T2:U36"><span class="mxinfo " id="T2:U37">3.3</span> / (<span class="mxinfo " id="T2:U38"><span class="var type1" id="S12T2U59">df</span> / (<span class="mxinfo " id="T2:U40"><span class="var type1" id="S6T2U62">fNyquist</span>*2</span>)</span>)</span></span>; <span class="comment">% Hamming window</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T2:U42"><span class="var type1" id="S14T2U66">filtorder</span> = <span class="mxinfo " id="T2:U44"><span class="mxinfo " id="T2:U45">ceil(<span class="mxinfo " id="T2:U46"><span class="var type1" id="S14T2U71">filtorder</span> / <span class="mxinfo " id="T2:U48">2</span></span>)</span> * <span class="mxinfo " id="T2:U49">2</span></span></span>; <span class="comment">% Filter order must be even.</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T44:U50"><span class="var type1" id="S16T44U76">dfArray</span> = {<span class="var type1" id="S12T2U79">df</span>, <span class="mxinfo " id="T8:U53">[<span class="mxinfo " id="T2:U54">-<span class="var type1" id="S12T2U83">df</span></span>, <span class="var type1" id="S12T2U84">df</span>]</span>; <span class="mxinfo " id="T2:U57">-<span class="var type1" id="S12T2U87">df</span></span>, <span class="mxinfo " id="T8:U59">[<span class="var type1" id="S12T2U90">df</span>, <span class="mxinfo " id="T2:U61">-<span class="var type1" id="S12T2U92">df</span></span>]</span>}</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T2:U63"><span class="var type1" id="S17T2U95">cutoffArray</span> = <span class="mxinfo " id="T2:U65"><span class="var type1" id="S8T2U97">edgeArray</span> + <span class="mxinfo " id="T2:U67"><span class="var type1" id="S16T44U100">dfArray</span>{<span class="var type1" id="S7T2U102">revfilt</span> + 1, length(<span class="var type1" id="S8T2U106">edgeArray</span>)} / <span class="mxinfo " id="T2:U71">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T25:U72"><span class="var type1" id="S19T25U110">winArray</span> = <span class="mxinfo " id="T25:U74"><span class="fcn" id="F110N9:B112">hamming</span>(<span class="mxinfo " id="T2:U75"><span class="var type1" id="S14T2U114">filtorder</span> + <span class="mxinfo " id="T2:U77">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T2:U78"><span class="var type1" id="S21T2U118">f</span> = <span class="mxinfo " id="T2:U80"><span class="var type1" id="S17T2U120">cutoffArray</span> / <span class="var type1" id="S6T2U121">fNyquist</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T25:U83"><span class="var type1" id="S22T25U124">w</span> = <span class="var type1" id="S19T25U125">winArray</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T2:U86"><span class="var type1" id="S23T2U128">m</span> = <span class="var type1" id="S14T2U129">filtorder</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T2:U89"><span class="var type1" id="S21T2U132">f</span> = <span class="mxinfo " id="T2:U91"><span class="var type1" id="S21T2U134">f</span> / <span class="mxinfo " id="T2:U93">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo " id="T23:U94"><span class="var type1" id="S22T23U138">w</span> = <span class="mxinfo " id="T23:U96"><span class="mxinfo " id="T25:U97"><span class="var type1" id="S22T25U141">w</span>(:)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T23:U99"><span class="var type1" id="S24T23U145">b</span> = <span class="mxinfo " id="T23:U101"><span class="fcn" id="F163N7:B147">fkernel</span>(<span class="var type1" id="S23T2U148">m</span>, <span class="var type1" id="S21T2U150">f</span>(1), <span class="var type1" id="S22T23U152">w</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo " id="T23:U105"><span class="var type1" id="S24T23U155">b</span> = <span class="mxinfo " id="T23:U107"><span class="fcn" id="F164N8:B157">fspecinv</span>(<span class="var type1" id="S24T23U158">b</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T2:U109"><span class="var type1" id="S27T2U161">nFrames</span> = <span class="mxinfo " id="T2:U111">1000</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T1:U112"><span class="var type1" id="S2T1U165">output_data</span> = <span class="mxinfo " id="T1:U114"><span class="fcn" id="F282N6:B167">firfilter</span>(<span class="var type1" id="S3T1U168">input_data</span>, <span class="var type1" id="S24T23U169">b</span>, <span class="var type1" id="S27T2U170">nFrames</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,29" id="srcline29">29</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,30" id="srcline30">30</a></span><span class="line"></span></span>
</pre>
